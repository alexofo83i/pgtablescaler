# PostgreSQL Table Scaler 🚀

Многопоточный инструмент для генерации тестовых данных и масштабирования записей в PostgreSQL таблицах. Использует команду COPY для максимальной производительности и HikariCP для эффективного пула соединений.

## 📋 Содержание
1. Возможности
1. Требования
1. Быстрый старт
1. Установка
1. Использование
1. Параметры подключения
1. Режимы работы
1. Примеры команд
1. Архитектура
Производительность
Конфигурация
Мониторинг
Часто задаваемые вопросы
Лицензия

## ✨ Возможности
🚀 Высокая производительность: Использование PostgreSQL COPY команды для вставки тысяч строк в секунду

* ⚡ Многопоточность: Распараллеливание операций на несколько потоков
* 📊 Автоопределение схемы: Автоматический анализ структуры таблицы и типов данных
* 🎲 Генерация данных: Создание реалистичных тестовых данных для всех стандартных типов
* 📈 Масштабирование: Увеличение объема данных путем копирования существующих записей
* 🔧 Гибкая настройка: Конфигурируемый размер пула соединений, батчей и количество потоков
* 📝 Современное логирование: Использование SLF4J + Logback с поддержкой MDC

## 📦 Требования
1. Java 11 или выше
1. PostgreSQL 9.6 или выше
1. Maven 3.6+ (для сборки)

## 🚀 Быстрый старт
bash
#### 1. Клонировать репозиторий
git clone https://github.com/yourusername/postgres-table-scaler.git
cd postgres-table-scaler

#### 2. Собрать проект
mvn clean package

#### 3. Сгенерировать 1 миллион записей в таблицу users
java -jar target/postgres-table-scaler-1.0.0-all.jar \
  --host localhost \
  --db mydb \
  --user postgres \
  -i users \
  -g -n 1000000 \
  -t 8 -b 10000

#### 4. Увеличить объем данных в 10 раз
java -jar target/postgres-table-scaler-1.0.0-all.jar \
  -i users \
  -o users_large \
  -s 10 \
  -t 16 -b 5000

## Установка:

#### 1. Сборка проекта
```bash
mvn clean package
```

#### 2. Сборка с профилем release
```bash
mvn clean package -Prelease
```

#### 3. Сборка uber-jar со всеми зависимостями
```bash
mvn clean package assembly:single
```

#### 4. Запуск с различными уровнями логирования
```bash
java -jar target/postgres-table-scaler-1.0.0-all.jar -i users -g -n 10000
```

#### 5. Запуск с debug логированием
```bash
java -Dlogging.level.com.example=DEBUG -jar target/postgres-table-scaler-1.0.0-all.jar -i users -g -n 10000
```

#### 6. Запуск с передачей параметров JVM для оптимизации
```bash
java -Xms2g -Xmx4g -XX:+UseG1GC -jar target/postgres-table-scaler-1.0.0-all.jar --host production-db --db analytics -i events -s 10 -t 16 -b 10000
```
## 📖 Использование
Параметры подключения
```text
Параметр	    Описание	            Значение по умолчанию
--host	        Хост PostgreSQL	        localhost
--port	        Порт	5432
--db	        Имя базы данных	         mydb
--user	        Имя пользователя	     postgres
--password	    Пароль	                 password
--schema	    Схема	                 public
--pool-size	    Размер пула соединений	 10
--auto-commit	AutoCommit режим	     false
```

## Режимы работы

#### 1. Режим генерации данных (-g, --generate)
```bash
-i, --table_in <таблица>   # Входная таблица
-n, --rows <число>         # Количество строк для генерации
```
#### 2. Режим масштабирования (-s, --scale)
```bash
-i, --table_in <таблица>    # Исходная таблица
-o, --table_out <таблица>    # Целевая таблица (опционально)
-s, --scale <фактор>         # Фактор масштабирования
```
#### 3. Общие параметры
```bash
-t, --threads <число>        # Количество потоков (по умолчанию: 1)
-b, --batch_size <число>     # Размер батча (по умолчанию: 1000)
```

## 💡 Примеры команд

#### 1. Генерация тестовых данных
```bash
# Простая генерация 10,000 записей
java -jar target/postgres-table-scaler-1.0.0-all.jar -i users -g -n 10000

# Генерация 1 миллиона записей в 8 потоков с батчами по 10,000
java -jar target/postgres-table-scaler-1.0.0-all.jar \
  -i users \
  -g -n 1000000 \
  -t 8 -b 10000

# Генерация с указанием параметров подключения
java -jar target/postgres-table-scaler-1.0.0-all.jar \
  --host production-db.company.com \
  --db analytics \
  --user replicator \
  --password secret \
  --schema public \
  -i events \
  -g -n 5000000 \
  -t 16 -b 25000
```
#### 2. Масштабирование данных
```bash
# Увеличение объема в 5 раз (в ту же таблицу)
java -jar target/postgres-table-scaler-1.0.0-all.jar -i users -s 5

# Масштабирование в новую таблицу
java -jar target/postgres-table-scaler-1.0.0-all.jar \
  -i users \
  -o users_scaled \
  -s 10

# Масштабирование с оптимизациями
java -jar target/postgres-table-scaler-1.0.0-all.jar \
  -i users \
  -o users_big \
  -s 20 \
  -t 32 \
  -b 50000
```  
#### 3. Комбинированные операции
```bash
# Генерация + масштабирование
java -jar target/postgres-table-scaler-1.0.0-all.jar \
  -i source \
  -g -n 100000 \
  -s 5 \
  -o target \
  -t 8 -b 10000
  ```

##  🏗 Архитектура
```text
┌─────────────────────────────────────────────────────────────┐
│                    PostgresTableScaler                      │
├─────────────────────────────────────────────────────────────┤
│                         Main                                │
├─────────────────────────────────────────────────────────────┤
│         ↓                           ↓                       │
│   TableGenerator               TableScaler                  │
│   (многопоточный)             (многопоточный)               │
├─────────────────────────────────────────────────────────────┤
│                    HikariCP Connection Pool                 │
├─────────────────────────────────────────────────────────────┤
│                    PostgreSQL COPY Command                  │
└─────────────────────────────────────────────────────────────┘
```
Поток выполнения:
1. Анализ структуры таблицы через DatabaseMetaData
2. Распределение работы по потокам
3. Каждый поток получает соединение из пула
4. Генерация/копирование данных батчами
5. Вставка через COPY с автоматическим коммитом


## ⚙️ Конфигурация
Параметры JVM для оптимальной производительности
```bash
# Для больших объемов данных
java -Xms4g -Xmx8g \
  -XX:+UseG1GC \
  -XX:MaxGCPauseMillis=200 \
  -XX:+ParallelRefProcEnabled \
  -XX:+UnlockExperimentalVMOptions \
  -XX:G1NewSizePercent=40 \
  -jar target/postgres-table-scaler-1.0.0-all.jar [options]
  ```

##  Метрики производительности
Для каждого запуска выводятся:

1. Количество обработанных строк
1. Общее время выполнения
1. Скорость вставки (строк/сек)
1. Прогресс по каждому потоку

Пример вывода:
```text
=== РЕЗУЛЬТАТЫ ГЕНЕРАЦИИ ===
Всего сгенерировано: 1,000,000 строк
Общее время: 6,543 мс
Средняя скорость: 152,834.33 rows/sec

Статистика по потокам:
  Поток 0: +125,000 строк (15,234.67 rows/sec)
  Поток 1: +125,000 строк (15,123.45 rows/sec)
  ...
```

## ❓ Часто задаваемые вопросы
#### Q: Какие типы данных поддерживаются?
#### A: Поддерживаются все стандартные типы PostgreSQL:

* Числовые: INTEGER, BIGINT, DECIMAL, NUMERIC, FLOAT
* Текстовые: VARCHAR, CHAR, TEXT
* Дата/время: DATE, TIME, TIMESTAMP
* Логические: BOOLEAN, BIT

####  Q: Как работает генерация уникальных значений?
####  A: Для текстовых полей добавляется rowId в начало строки. Для других типов используются случайные значения с учетом seed для воспроизводимости.

####  Q: Что происходит с auto-increment колонками?
####  A: Auto-increment колонки (SERIAL, BIGSERIAL) автоматически исключаются из вставки, позволяя базе данных генерировать значения.

####  Q: Как выбрать оптимальный размер батча?
####  A: Рекомендуемые значения:

* Для небольших таблиц (< 1 млн): 1,000 - 5,000
* Для средних таблиц (1-10 млн): 5,000 - 10,000
* Для больших таблиц (> 10 млн): 10,000 - 50,000

####  Q: Сколько потоков использовать?
####  A: Оптимальное количество зависит от:

* Количества ядер CPU
* Производительности дисковый подсистемы
* Настроек PostgreSQL (max_connections)

Обычно хорошие результаты дают 4-16 потоков.

